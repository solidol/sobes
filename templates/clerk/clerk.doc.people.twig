{% extends "index.twig" %}

{% block title %}
    Картка № {{doc.fullnum}}
{% endblock %}
{% block content %}
    <div class="container">
        <div class="row">
            <div class="col-md-12">
                <a href="{{path('clerk.doc.new.people')}}" class="btn btn-success">НОВЕ ЗВЕРНЕННЯ</a>
            </div>
            <!--<div class="col-md-2">
                <a href="{{path('clerk.doc.new.collect')}}" class="btn btn-success">ДОДАТИ КЗ</a>
            </div>
            -->

        </div>
    </div>
    <table width="100%" border="1">
        <tr {%if doc.impstatus=='ugl' %}style="background-color: rgb(255, 151, 140);"{%endif%}>
            <td align="center" style="font-size:40px;">
                {%if doc.impstatus=='ugl' %} УГЛ {%endif%}
                <br/>
                {% if doc.donestatus=="p" %}

                    <span style="background-color: rgb(0, 150, 60); color:#ffffff; ">
                        <span style="width: 150px; font-size:40px;">+</span>
                    </span>

                {% elseif doc.donestatus=="m" %}

                    <span style="background-color: rgb(255, 0, 0); color:#ffffff; font-size:40px; ">
                        <span style="width: 150px; font-size:40px;">-</span>
                    </span>

                {% elseif doc.donestatus=="к" %}

                    <span style="background-color: rgb(0, 0, 255); color:#ffffff; font-size:40px; ">
                        <span style="width: 150px; font-size:40px;">P</span>
                    </span>


                {% elseif doc.donestatus=="e" %}
                {% else %}

                {% endif %}
            </td>
            <td  align="center">
                <h1>
                    КАРТКА ОБЛІКУ<br>
                    скарг, заяв, пропозицій
                </h1>
            </td>
            <td align="center">
                <button id="save" class="btn btn-warning" style="display:none;">Зберегти</button>
            </td>
        </tr>
        <tr>
            <td width="25%"  align="center">
                <h2>№ 
                    <span id="{{doc.id}}:mainfield:num_prefix_1" contenteditable="true">{{doc.num_prefix_1}}</span>
                    -
                    <span id="{{doc.id}}:mainfield:internal_number" contenteditable="true">{{doc.internal_number}}</span>
                    : {{doc.year}}
                </h2>

            </td>

            <td  align="center">
                <div class="date_in_text">Створено <span id="{{doc.id}}:mainfield:date_in" contenteditable="true">{{doc.date_in_text}}</span></div>
                <div class="date_control_text">КОНТРОЛЬ <span id="{{doc.id}}:mainfield:date_control" contenteditable="true">{{doc.date_control_text}}</span></div>
            </td>
            <td width="25%" align="center">
                <div class="btn-group-vertical">

                    {% if doc.status!='archived' %}
                        <!--<a href="{{path('clerk.doc.edit',{'doc':doc.id})}}" class="btn btn-warning">Редагувати</a>-->
                    {% endif %}


                    {% if ((doc.donestatus!='p') and (doc.donestatus!='m') and (doc.donestatus!='r'))%}

                        <button type="button" id="addresolutonbtn" class="btn btn-info" data-toggle="modal" data-target="#orgModal">Додати резолюцію</button>
                        {% if doc.status=='hasresolution' and doc.status!='archived'%}

                            <button type="button" id="addresolutonbtn" class="btn btn-success" data-toggle="modal" data-target="#moveModal">Передати документ</button>    
                        {% endif %}
                        <button type="button" id="setstatusbutton" class="btn btn-danger" data-toggle="modal" data-target="#statusModal">Остаточне виконання</button>                
                    {% endif %}

                </div>
            </td>
        </tr>
        <tr>
            <td width="20%">
                Громадянин (громадяни)
            </td>
            <td colspan="2">
                {% for item in doc.peoples %}
                    <div>
                        <a href="{{path('clerk.people.edit',{'pid':item.full[0].id})}}" target="_blank" 
                           onClick="window.open(this.href, '', 'scrollbars=1,top=' + ((screen.height - 400) / 2) + ',left=' + ((screen.width - 1000) / 2) + ',width=1000,height=600,menubar=no,toolbar=no,location=no');
                                   return false;">
                            <span class="_blank fa fa-file-text-o fa-1x"></span>
                            {{item.full[0].lastname}} 
                            {{item.full[0].firstname}}
                            {{item.full[0].secondname}}
                            {{item.full[0].street}}, 
                            буд. {{item.full[0].building}}
                            {% if item.full[0].housing!='' %}/{{item.full[0].housing}}{% endif %}, 
                            {% if item.full[0].room!='' %}кв. {{item.full[0].room}}{% endif %}
                        </a>
                    </div>
                {% endfor %}
            </td>
        </tr>


        <tr>
            <td width="20%">
                Звідки, дата, номер
            </td>
            <td colspan="2">
                {% if doc.externals is not empty %}

                    {% for item in doc.externals %}
                        <div id="{{item.id}}:metafield:extnum" contenteditable="true">    
                            {{item.serial.fullstr}}
                        </div>
                    {% endfor %}
                {% endif %}
            </td>
        </tr>
        <tr>
            <td width="20%">
                Надійшла повторно
            </td>
            <td colspan="2">
                {% if doc.isreapeted!='no' %}
                    повтор №{{doc.isreapeted}}
                {% else %}
                    -
                {% endif %}
            </td>
        </tr>
        <tr>
            <td width="20%">
                Зміст
            </td>
            <td colspan="2">
                <div id="{{doc.id}}:mainfield:summary" contenteditable="true">{{doc.summary}}</div>
            </td>
        </tr>
        <tr>
            <td width="20%">
                Резолюція
            </td>
            <td colspan="2">
                {% if doc.resolution is not empty %}
                    {% for item in doc.resolution %}
                        <div id="{{item.id}}:metafield:movings" contenteditable="true">{{item.serial.fullstr}}</div>

                    {% endfor %}
                {% endif %}
            </td>
        </tr>
        <tr>
            <td width="20%">

                <div class="input-group">
                    Відмітки про виконання
                    <div class="input-group-btn">
                        <button class="btn btn-default" type="button"  data-toggle="modal" data-target="#doneNotesModal">
                            <i class="glyphicon glyphicon-plus"></i>
                        </button>
                    </div>
                </div>
            </td>
            <td colspan="2">
                {% if doc.donestr is not empty %}
                    {% for item in doc.donestr %}
                        <div id="{{item.id}}:metafield:donestr" contenteditable="true">{{item.serial.fullstr}}</div>

                    {% endfor %}
                {% endif %}
            </td>
        </tr>

        <tr>
            <td width="20%">
                <div class="input-group">
                    Інші відмітки
                    <div class="input-group-btn">
                        <button class="btn btn-default" type="button"  data-toggle="modal" data-target="#otherNotesModal">
                            <i class="glyphicon glyphicon-plus"></i>
                        </button>
                    </div>
                </div>

            </td>
            <td colspan="2">
                {% if doc.notes is not empty %}
                    {% for item in doc.notes %}
                        <div id="{{item.id}}:metafield:notes" contenteditable="true">{{item.serial.fullstr}}</div>
                    {% endfor %}
                {% endif %}
            </td>
        </tr>
        <tr>
            <td width="20%">
                <div class="input-group">
                    Історія передачі документу

                </div>

            </td>
            <td colspan="2">
                {% if doc.movings is not empty %}
                    {% for item in doc.movings %}
                        <div id="{{item.id}}:metafield:movings" contenteditable="true">{{item.serial.fullstr}}</div>
                    {% endfor %}
                {% endif %}
            </td>
        </tr>

    </table>
    <script>

    </script>

    {% include 'popup.resolution.twig' %}
    {% include 'popup.docmov.twig' %}
    {% include 'popup.setstatus.twig' %}
    {% include 'popup.notes.twig' %}
{% endblock %}
